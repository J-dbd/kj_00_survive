<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>정글에서 살아남기</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/flowbite/1.8.1/flowbite.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/flowbite/1.8.1/flowbite.min.js"></script>
    <script src="http://code.jquery.com/jquery-3.5.1.min.js"></script>
</head>

<body>
    <div class="flex items-center justify-center h-screen bg-black">
        <div class="flex flex-col items-center justify-center bg-white w-[420px] h-[300px]">
            <div class="sm:mx-auto sm:w-full sm:max-w-sm">
                <img class="mx-auto h-10 w-13" src="/static/title.png" alt="survive in jungle">
            </div>
            <div class="mt-10 sm:mx-auto sm:w-full sm:max-w-sm">
                <form class="space-y-3" id="form">
                    <div>
                        <div class="mt-2">
                            <input name='id' type="id" id="id"
                                class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500"
                                placeholder="ID" required>
                        </div>
                    </div>

                    <div>
                        <div class="flex items-center justify-between">
                        </div>
                        <div class="mt-2">
                            <input name='password' type="password" id="password"
                                class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500"
                                required placeholder="PASSWORD">
                        </div>
                    </div>
                    <div>
                        <div class="flex items-center justify-between">
                            <p id="validation" class="text-left text-red-500 italic text-sm"></p>
                            <div class="text-sm">
                                <a href="{{ url_for('forgot_pwd') }}">Forgot
                                    password?</a>
                            </div>
                        </div>
                    </div>


                    <div class="grid md:grid-cols-2 md:gap-6">
                        <button type="button"
                            class="flex w-full justify-center rounded-md bg-green-600 px-3 py-1.5 text-sm font-semibold leading-6 text-white shadow-sm hover:bg-green-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-green-600"
                            onclick="login()">
                            Login</button>
                        <button type="button"
                            class="flex w-full justify-center rounded-md bg-green-600 px-3 py-1.5 text-sm font-semibold leading-6 text-white shadow-sm hover:bg-green-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-green-600"
                            onclick="window.location.href=`{{ url_for('sign_in') }}` ">Sign
                            up</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</body>
<script>
    function login() {
        const url = '/login'
        let formData = new FormData($('#form')[0])
        $.ajax({
            url: url,
            type: "POST",
            async: true,
            data: formData,
            enctype: "multipart/form-data",
            cache: false,
            contentType: false,
            processData: false,
            error: function (request, status, error) {
                console.log("code: " + request.status)
                console.log("message: " + request.responseText)
                console.log("error: " + error);
            },
            success: function (res) {
                console.log("success")
                console.log("res", res)
                if (res['result'] == "success") {
                    localStorage.setItem('token', res.access_token);
                    alert("로그인에 성공하였습니다.")
                    window.location.href = "{{ url_for('forgot_pwd') }}"
                }
                else {
                    $("#validation").html(res['reason']).show();
                }

            }

        })
    }
</script>

</html>